<html>
    <head>
        <!-- Import the Amplience Delivery SDK-->
        <script src="https://unpkg.com/dc-delivery-sdk-js/dist/dynamicContent.browser.umd.min.js"></script>
    </head>
    <body>
         <!-- Add a DIV with a container -->
        <div id="amplience-stylitics-widget-container"></div>
         <!-- Add Script -->
         <script>
            const styliticsViewMapping = {
                classic: {
                    script: "https://web-assets.stylitics.com/v3-classic/latest/classic.release.js",
                    name: "StyliticsClassicWidget"
                },
                hotspots: {
                    script: "https://web-assets.stylitics.com/v3-hotspots/latest/hotspots.release.js",
                    name: "StyliticsHotspotsWidget"
                },
                moodboard: {
                    script: "https://web-assets.stylitics.com/v3-moodboard/latest/moodboard.release.js",
                    name: "StyliticsMoodboardWidget"
                },
                gallery: {
                    script: "https://web-assets.stylitics.com/v3-gallery/latest/gallery.release.js",
                    name: "StyliticsGalleryWidget"
                },
                mainAndDetail: {
                    script: "https://web-assets.stylitics.com/v3-main-and-detail/latest/main-and-detail.release.js",
                    name: "StyliticsMainAndDetailWidget"
                }
            }
            // Get the parameters from the URL
            const queryString = window.location.search;
            console.log(queryString);
            const urlParams = new URLSearchParams(queryString);
            const vse = urlParams.get('vse') || '3xnwwvf4dk7t19dr5sf6cuvb9.staging.bigcontent.io'
            const contentID = urlParams.get('contentID') || '891f8228-9b3d-4827-b83e-9a4ffebb02a5'
            console.log(contentID)


            // Insantiate the SDK
            var ampSDKConfig = {
                account: 'nmdemostore'
            }
            if(vse) ampSDKConfig.stagingEnvironment = vse
            const client = new ampDynamicContent.ContentClient(ampSDKConfig);

            client
            .renderContentItem(contentID, 'stylitics-generic-renderer')
            .then((content) => {
                console.log(content.body);
                var element = document.getElementById('amplience-stylitics-widget-container')
                console.log(element)
                element.innerHTML = content.body

                // get the data attribute of the rendered element!!!
                var renderedElement = document.getElementById('amplience-stylitics-widget-generic-container')
                var elementData = renderedElement.getAttribute('data-amp-stylitics-data')
                console.log(decodeURIComponent(elementData))
                var elementObject = JSON.parse(decodeURIComponent(elementData))
                console.log(elementObject)

                const styliticsObj = styliticsViewMapping[elementObject.view] || styliticsViewMapping['classic']
                var styliticsScript = document.createElement('script');
                styliticsScript.onload = function () {
                    console.log("The script has loaded")
                    let widgetInstance = new window[styliticsObj.name]( "puma", "amplience-stylitics-widget-container", {
                        api: {
                            item_number: elementObject.sku,
                            max: elementObject.max,
                            min: elementObject.min
                        },
                        display: {
                            disableMnM: true,
                            imglazyLoadNextScreen: true,
                            hideAnchorItem: false
                        },
                    });
                    widgetInstance.start();
                };
                styliticsScript.src = styliticsObj.script;
                document.head.appendChild(styliticsScript)
            })
            .catch((error) => {
                console.log('content not found', error);
            });
            /*
                Authorable attributes in Amplience
                - item_number: string (possible ecomm toolkit)
                - min: number: Default 3
                - max:number: Default 10
                - tags: array of strings
                - Mix & Match: Boolean (default true)
                - Image Lazy Loading: Boolean (default true)
                - Hide Anchor Item: Boolean (default false)

            */
            
            </script>
    </body>
</html>